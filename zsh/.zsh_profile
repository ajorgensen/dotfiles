if [[ -n "$ZSH_DEBUGRC" ]]; then
    zmodload zsh/zprof
fi

export XDG_CONFIG_HOME="$HOME/.config"
eval "$(/opt/homebrew/bin/brew shellenv)"

bindkey -e
bindkey -s ^f "tmux-sessionizer\n"

autoload -z edit-command-line
zle -N edit-command-line
bindkey "^X^E" edit-command-line

export SHELL="$(which zsh)"
export EDITOR="nvim"
alias vim="nvim"
alias e="nvim"

fzf-git-branch-widget() {
  local selected_branch
  selected_branch=$(
    git for-each-ref --sort=-committerdate refs/heads/ \
      --format='%(refname:short)' |
    fzf --height=20% --reverse --info=inline --preview 'git log --oneline -n 10 {}' < /dev/tty
  )

  if [[ -n "$selected_branch" ]]; then
    LBUFFER+="$selected_branch"
  fi
  
  # Force zsh to redraw the prompt
  zle reset-prompt
  zle -R
}

addToPath() {
    if [[ "$PATH" != *"$1"* ]]; then
        export PATH=$PATH:$1
    fi
}

addToPathFront() {
    if [[ "$PATH" != *"$1"* ]]; then
        export PATH=$1:$PATH
    fi
}

addToPathFront $HOME/go/bin
addToPathFront $HOME/.local/bin
addToPathFront $HOME/.local/sbin

[[ -f "$HOME/.local.zshrc" ]] && source $HOME/.local.zshrc

if ! pgrep -x -u "${USER}" gpg-agent >/dev/null 2>&1; then
  gpg-connect-agent /bye >/dev/null 2>&1
fi
alias gpg-unlock="gpg-connect-agent updatestartuptty /bye"

zle -N fzf-git-branch-widget
bindkey ^x "fzf-git-branch-widget"

zstyle ':completion:*:make:*:targets' call-command true
zstyle ':completion:*:*:make:*' tag-order 'targets'

if [[ -n "$ZSH_DEBUGRC" ]]; then
    zprof
fi
