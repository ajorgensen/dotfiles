setopt PROMPT_SUBST
setopt AUTO_CD

# zsh auto completion system
fpath=(~/.zsh/completion $fpath)
fpath=(~/.zsh/functions $fpath)
fpath=(/usr/local/share/zsh-completions $fpath)

autoload -U compinit
compinit
#compinit -d $HOME/zsh/dumpfile
unsetopt nomatch

# show completion menu when number of options is at least 2
zstyle ':completion:*' menu select=2
zstyle ":completion:*:descriptions" format "%B%d%b"

# reset path
export PATH=""

# Add paths that should have been there by default
export PATH=${PATH}:$HOME/.nix-profile/bin:$HOME/.nix-profile/sbin
export PATH=${PATH}:$HOME/bin:$HOME/Applications
export PATH=${PATH}:/usr/local/Cellar
export PATH=${PATH}:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/bin:/sbin:/usr/sbin:/bin
export PATH=$PATH:/usr/local/m-cli
export PATH=${PATH}:$HOME/.zsh/zsh-git-prompt/src/.bin

# Flutter
export PATH=$HOME/flutter/bin:$PATH

# Colorize terminal
export TERM='screen-256color' # Don't change, `xterm-256color` will break curses in tmux
export GREP_OPTIONS="--color"

# Nicer history
export HISTSIZE=10000000
export HISTFILE="$HOME/.zsh_history"
export SAVEHIST=$HISTSIZE
export HISTCONTROL=ignorespace
setopt HIST_IGNORE_ALL_DUPS HIST_REDUCE_BLANKS INC_APPEND_HISTORY EXTENDED_HISTORY
setopt append_history
setopt inc_append_history
setopt share_history

# GPG
export GPG_TTY=`tty`

### Functions for setting and getting environment variables from the OSX keychain ###
# Use: keychain-environment-variable CHEF_PUSH_KEY
function keychain-environment-variable () {
    security find-generic-password -w -a ${USER} -D "environment variable" -s "${1}"
}

# Use: set-keychain-environment-variable CHEF_PUSH_KEY "secret"
function set-keychain-environment-variable () {
    [ -n "$1" ] || print "Missing environment variable name"
    [ -n "$2" ] || print "Missing environment variable value"
    ( [ -n "$1" ] && [ -n "$2" ] ) || return 1
    security add-generic-password -U -a ${USER} -D "environment variable" -s "${1}" -w "${2}"
}

# GO
export GOPATH="$HOME/go"
export PATH="$PATH:$GOPATH/bin"

# Rust
export PATH="$PATH:$HOME/.cargo/bin"

# Android
export ANDROID_HOME=$HOME/Library/Android/sdk
export PATH=$PATH:$ANDROID_SDK/tools:$ANDROID_SDK/platform-tools
export GRADLE_OPTS="-Xmx1024m -Xms256m -XX:MaxPermSize=512m"

export VISUAL=vim
export EDITOR="$VISUAL"
bindkey -e

# Use qt4 because capybara-webkit needs it to compile
export QMAKE=/usr/bin/qmake-qt4

autoload -U history-search-end

zle -N history-beginning-search-backward-end history-search-end
zle -N history-beginning-search-forward-end history-search-end
[[ -n "${key[Up]}" ]] && bindkey "${key[Up]}" history-beginning-search-backward-end
[[ -n "${key[Down]}" ]] && bindkey "${key[Down]}" history-beginning-search-forward-end
bindkey '^P' history-incremental-search-backward
bindkey '^N' history-incremental-search-forward

autoload -U edit-command-line
zle -N edit-command-line
bindkey '\C-x\C-e' edit-command-line

export WORDCHARS='*?[]~&;!$%^<>'

export ACK_COLOR_MATCH='red'

# ACTUAL CUSTOMIZATION OH NOES!
gd() { git diff $* | view -; }
gdc() { gd --cached $*; }

function mcd() { mkdir -p $1 && cd $1 }

export MARKPATH=$HOME/.marks

# Allows commit message without typing quotes (can't have quotes in the commit msg though).
function gc {
  git commit -m "$*"
}

## case-insensitive (all), partial-word and then substring completion
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}' \
    'r:|[._-]=* r:|=*' 'l:|=* r:|=*'

# Sourcing of other files
source $HOME/.zsh/aliases
source $HOME/.zsh/functions/zgitinit

NEWLINE=$'\n'
PROMPT='%d %b ${NEWLINE}ðŸš€  '
GIT_PROMPT_EXECUTABLE="haskell"

if [[ -a $HOME/.localrc ]]; then
  source $HOME/.localrc
fi

bindkey '\e[A' history-beginning-search-backward
bindkey '\e[B' history-beginning-search-forward

#### Added by the Heroku Toolbelt
export PATH="/usr/local/heroku/bin:$PATH"

# ruby
export PATH="$HOME/.rbenv/bin:$HOME/.rbenv/shims:$PATH"
eval "$(rbenv init -)"

# FZF
source $HOME/.iterm2_shell_integration.zsh
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

export FZF_DEFAULT_COMMAND='ag -g ""'

# So tmux plays nice with HyperTerm
export LANG=en_US.UTF-8

export KEYTIMEOUT=1

# The next line updates PATH for the Google Cloud SDK.
if [ -f '/Users/ajorgensen/Downloads/google-cloud-sdk/path.zsh.inc' ]; then . '/Users/ajorgensen/Downloads/google-cloud-sdk/path.zsh.inc'; fi

# The next line enables shell command completion for gcloud.
if [ -f '/Users/ajorgensen/Downloads/google-cloud-sdk/completion.zsh.inc' ]; then . '/Users/ajorgensen/Downloads/google-cloud-sdk/completion.zsh.inc'; fi
